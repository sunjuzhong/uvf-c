<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <title>VTP → UVF Web Demo</title>
</head>
<body>
  <h1>VTP → UVF Web Demo</h1>
  <input type="file" id="vtpFile" accept=".vtp">
  <button id="convertBtn">转换为 UVF</button>
  <a id="downloadLink" style="display:none">下载 UVF</a>
  <script type="module">
    import UVFModule from './uvf.js';
    let Module;
    UVFModule().then(m => { Module = m; });
    document.getElementById('convertBtn').onclick = async () => {
      const fileInput = document.getElementById('vtpFile');
      if (!fileInput.files.length) return alert('请选择 VTP 文件');
      const file = fileInput.files[0];
      const arrayBuffer = await file.arrayBuffer();
      Module.FS_createDataFile('/', 'input.vtp', new Uint8Array(arrayBuffer), true, true);
      const ok = Module._generate_uvf('/input.vtp', '/output.uvf');
      if (ok) {
        const uvfData = Module.FS_readFile('/output.uvf');
        const blob = new Blob([uvfData], {type: 'application/octet-stream'});
        const url = URL.createObjectURL(blob);
        const link = document.getElementById('downloadLink');
        link.href = url;
        link.download = 'output.uvf';
        link.style.display = '';
        link.textContent = '下载 UVF';
      } else {
        alert('转换失败');
      }
    };
  </script>
</body>
</html>
